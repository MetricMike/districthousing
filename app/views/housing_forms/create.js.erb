<% byebug %>
var id = "<%= @housing_form.id%>";
var coordinates=[];
var geocoder= new google.maps.Geocoder;

$.when(
    $.ajax( {

      geocoder.geocode({
        'address': address,
        'region': 'us'
      }, function(results, status) {
        var result;
        if (status === google.maps.GeocoderStatus.OK) {
          coordinates[0] = results[0].geometry.location.lat();
          coordinates[1] = results[0].geometry.location.lng();
          alert('geocode lat' + coordinates[0]);
          update_coordinates(coordinates);
        } else {
          result = 'Unable to find address: ' + status;
          alert('Address not found.');
        }
      });
    })
).then ($.ajax({

    type: 'PATCH',
    async: false,
    url: '/housing_forms/' + "<%= @housing_form.id%>",
    dataType: "json",
    data: {
      'name': "<%= @housing_form.name %>",
      'housing_form': <%= @housing_form.to_json.to_s.html_safe %>
    },
    success: function(data) {
      console.log('successfully updated coordinates');
      $(window.location.replace("/housing_forms/<%= @housing_form.id %>"));
    },
    error: function(data) {
      console.log('failed updating coordinates');
      $(window.location.replace("/housing_forms/<%= @housing_form.id %>"));
    }
  })
    );




  $(window.location.replace("/housing_forms/<%= @housing_form.id %>"));




